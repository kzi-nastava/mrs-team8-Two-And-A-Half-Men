import{a as g}from"./chunk-WZWIJEA2.js";import{Ac as u,K as r,P as a,Xb as c,fa as l}from"./chunk-GHGVHUHC.js";import{a as i}from"./chunk-TSRGIXR5.js";var s=class o{TOKEN_KEY="jwt_token";token=null;setToken(e,t=!1){this.token=e,t?(sessionStorage.setItem(this.TOKEN_KEY,e),localStorage.removeItem(this.TOKEN_KEY)):(localStorage.setItem(this.TOKEN_KEY,e),sessionStorage.removeItem(this.TOKEN_KEY))}removeToken(){this.token=null,sessionStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.TOKEN_KEY)}getToken(){if(this.token)return this.token;let e=sessionStorage.getItem(this.TOKEN_KEY);if(e)return this.token=e,e;let t=localStorage.getItem(this.TOKEN_KEY);return t?(this.token=t,t):null}static \u0275fac=function(t){return new(t||o)};static \u0275prov=r({token:o,factory:o.\u0275fac,providedIn:"root"})};var m=class o{http=a(u);tokenService=a(s);_user=l(null);user=this._user.asReadonly();userProfileImage=c(()=>this._user()?.imgSrc||"assets/default-profile.png");constructor(){this.tokenService.getToken()&&this.fetchUserInfo()}saveLogin(e,t,n=!1){this._user.set(t),this.tokenService.setToken(e,!n)}logout(){this._user.set(null),this.tokenService.removeToken()}isLoggedIn(){return this.tokenService.getToken()!==null}fetchUserInfo(){return this.http.get(`/api/${g.apiVersion}/me`).subscribe({next:e=>this._user.set(e),error:()=>{this.logout()}})}updateUserInfo(e){this._user()&&this._user.update(n=>i(i({},n),e))}updateToken(e){this.tokenService.setToken(e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=r({token:o,factory:o.\u0275fac,providedIn:"root"})};export{s as a,m as b};
