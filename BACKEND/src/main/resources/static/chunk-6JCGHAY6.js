import{a as q}from"./chunk-UHK5O6KU.js";import{a as R}from"./chunk-HPW7WUYP.js";import{a as E,b as V}from"./chunk-HPMAGG7F.js";import{a as D}from"./chunk-ZCQDYGVD.js";import{a as S,b as T,c as U}from"./chunk-ZZU5WPUM.js";import{a as I}from"./chunk-QXKYPX7G.js";import"./chunk-OXPWAMAC.js";import{d as O,f as y}from"./chunk-DMUBA5XY.js";import{b as w}from"./chunk-GX4BJWGY.js";import"./chunk-WZWIJEA2.js";import{Ha as r,Hb as c,Jb as k,P as h,U as C,V as _,Va as M,W as f,X as x,Za as P,eb as m,fa as g,fb as b,kb as d,lb as i,mb as o,nb as p,ub as v,wb as u,yb as s}from"./chunk-GHGVHUHC.js";import"./chunk-TSRGIXR5.js";function B(t,n){if(t&1){let e=v();i(0,"button",12),u("click",function(){C(e);let l=s();return _(l.blockUser())}),f(),i(1,"svg",6),p(2,"circle",13)(3,"path",14),o(),c(4," Block User "),o()}if(t&2){let e=s();d("disabled",e.isProcessing())}}function N(t,n){if(t&1){let e=v();i(0,"button",15),u("click",function(){C(e);let l=s();return _(l.unblockUser())}),f(),i(1,"svg",6),p(2,"path",16)(3,"path",17),o(),c(4," Unblock User "),o()}if(t&2){let e=s();d("disabled",e.isProcessing())}}function A(t,n){t&1&&(i(0,"div",10),p(1,"div",18),i(2,"p"),c(3,"Loading user details..."),o()())}function F(t,n){if(t&1&&(i(0,"div",19)(1,"div",27),f(),i(2,"svg",28),p(3,"circle",13)(4,"path",14),o()(),x(),i(5,"div",29)(6,"h3"),c(7,"User is Blocked"),o(),i(8,"p")(9,"strong"),c(10,"Reason:"),o(),c(11),o()()()),t&2){let e=s(2);r(11),k(" ",e.personalInfo().blockReason)}}function L(t,n){if(t&1){let e=v();i(0,"app-request-change-preview",20)(1,"button",30),u("click",function(){C(e);let l=s(2);return _(l.rejectChangeRequest())}),c(2," \u2715 Reject Changes "),o(),i(3,"button",31),u("click",function(){C(e);let l=s(2);return _(l.approveChangeRequest())}),c(4," \u2713 Approve Changes "),o()()}if(t&2){let e=s(2);d("personalInfo",e.personalInfo())("vehicleInfo",e.vehicleInfo())("request",e.pendingChangeRequest()),r(),d("disabled",e.isProcessing()),r(2),d("disabled",e.isProcessing())}}function G(t,n){t&1&&(f(),i(0,"svg",6),p(1,"path",32),o())}function H(t,n){t&1&&(f(),i(0,"svg",6),p(1,"path",33),o())}function Y(t,n){t&1&&P(0,H,2,0,"ng-template",23)}function J(t,n){if(t&1&&(i(0,"app-tab-content",25),p(1,"app-vehicle-info-form",34),o()),t&2){let e=s(2);d("tabId","vehicle")("activeTab",e.activeTab()),r(),d("readonly",!0)("vehicleInfo",e.vehicleInfo())("vehicleTypes",e.vehicleTypes())("availableServices",e.availableServices())}}function K(t,n){if(t&1){let e=v();i(0,"div",11),m(1,F,12,1,"div",19),m(2,L,5,5,"app-request-change-preview",20),i(3,"app-tab-navigation",21),u("tabChange",function(l){C(e);let z=s();return _(z.onTabChange(l))}),P(4,G,2,0,"ng-template",22),m(5,Y,1,0,null,23),o(),i(6,"div",24)(7,"app-tab-content",25),p(8,"app-personal-info-form",26),o(),m(9,J,2,6,"app-tab-content",25),o()()}if(t&2){let e=s();r(),b(e.personalInfo().blocked&&e.personalInfo().blockReason?1:-1),r(),b(e.pendingChangeRequest()?2:-1),r(),d("tabs",e.tabs)("activeTab",e.activeTab())("alignment","left"),r(2),b(e.vehicleInfo()?5:-1),r(2),d("tabId","personal")("activeTab",e.activeTab()),r(),d("readonly",!0)("personalInfo",e.personalInfo())("showPhotoUpload",!0),r(),b(e.vehicleInfo()?9:-1)}}var j=class t{userId=null;isLoading=g(!1);activeTab=g("personal");personalTab={id:"personal",label:"Personal data",position:"left"};vehicleTab={id:"vehicle",label:"Vehicle data",position:"left"};get tabs(){let n=[this.personalTab];return this.vehicleInfo()&&n.push(this.vehicleTab),n}personalInfo=g(null);vehicleInfo=g(null);pendingChangeRequest=g(null);vehicleTypes=g([]);availableServices=g([]);isProcessing=g(!1);route=h(O);router=h(y);usersService=h(q);vehicleService=h(D);popupsService=h(w);ngOnInit(){try{let n=this.route.snapshot.paramMap.get("userId");if(!n){this.router.navigate(["/error/not-found"],{queryParams:{msg:"User not found"}}).then();return}if(this.userId=parseInt(n,10),isNaN(this.userId)){this.router.navigate(["/error/not-found"],{queryParams:{msg:"User id not a number"}}).then();return}this.loadUserDetails()}catch(n){}}loadUserDetails(){this.userId&&(this.isLoading.set(!0),this.usersService.getUserDetails(this.userId).subscribe({next:n=>{this.personalInfo.set(n.personalInfo),this.vehicleInfo.set(n.vehicleInfo||null),this.pendingChangeRequest.set(n.pendingChangeRequest||null),n.vehicleInfo&&this.loadVehicleOptions(),this.isLoading.set(!1)},error:n=>{console.error("Error loading user details:",n),this.isLoading.set(!1),this.popupsService.error("Error","Failed to load user details. Please try again later.",{onConfirm:()=>this.router.navigate(["users"]).then(),buttonText:"Go Back"})}}))}loadVehicleOptions(){this.vehicleService.getVehicleOptions().subscribe({next:n=>{this.vehicleTypes.set(n.vehicleTypes),this.availableServices.set(n.additionalServices)},error:n=>{console.error("Failed to load vehicle options",n)}})}goBack(){this.router.navigate(["users"]).then()}openChat(){alert("Chat feature coming soon!")}onTabChange(n){this.activeTab.set(n)}blockUser(){this.userId&&this.popupsService.prompt("Block User","Please provide a reason for blocking this user:","Reason for blocking",n=>{this.isProcessing.set(!0),this.usersService.blockUser(this.userId,n).subscribe({next:()=>{this.isProcessing.set(!1),this.loadUserDetails(),this.popupsService.success("User Blocked","The user has been blocked successfully.")},error:e=>{console.error("Error blocking user:",e),this.isProcessing.set(!1),this.popupsService.error("Error","Failed to block user. Please try again later.")}})})}unblockUser(){this.userId&&this.popupsService.confirm("Unblock User","Are you sure you want to unblock this user?",()=>{this.isProcessing.set(!0),this.usersService.unblockUser(this.userId).subscribe({next:()=>{this.isProcessing.set(!1),this.loadUserDetails(),this.popupsService.success("User Unblocked","The user has been unblocked successfully.")},error:n=>{console.error("Error unblocking user:",n),this.isProcessing.set(!1),this.popupsService.error("Error","Failed to unblock user. Please try again later.")}})})}approveChangeRequest(){let n=this.pendingChangeRequest();n&&this.popupsService.confirm("Approve Changes","Are you sure you want to approve these changes? This action cannot be undone.",()=>{this.isProcessing.set(!0),this.usersService.approveChangeRequest(n.id).subscribe({next:()=>{this.isProcessing.set(!1),this.loadUserDetails(),this.popupsService.success("Changes Approved","The changes have been approved successfully.")},error:e=>{this.popupsService.error("Error","Failed to approve changes. Please try again later."),this.isProcessing.set(!1),console.error("Error approving changes:",e)}})})}rejectChangeRequest(){let n=this.pendingChangeRequest();n&&this.popupsService.confirm("Reject Changes","Are you sure you want to reject these changes? This action cannot be undone.",()=>{this.isProcessing.set(!0),this.usersService.rejectChangeRequest(n.id).subscribe({next:()=>{this.isProcessing.set(!1),this.loadUserDetails(),this.popupsService.success("Changes Rejected","The changes have been rejected successfully.")},error:e=>{console.error("Error rejecting changes:",e),this.isProcessing.set(!1),this.popupsService.error("Error","Failed to reject changes. Please try again later.")}})})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-user-details-page"]],decls:16,vars:4,consts:[[1,"user-detail-container"],[1,"header"],[1,"btn-back",3,"click"],[1,"header-title"],[1,"header-actions"],[1,"btn-chat",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none"],["d","M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke","currentColor","stroke-width","2"],[1,"btn-block",3,"disabled"],[1,"btn-unblock",3,"disabled"],["appBox","",1,"loading"],[1,"user-content"],[1,"btn-block",3,"click","disabled"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","2"],["d","M4.93 4.93l14.14 14.14","stroke","currentColor","stroke-width","2"],[1,"btn-unblock",3,"click","disabled"],["d","M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z","stroke","currentColor","stroke-width","2"],["d","M9 12l2 2 4-4","stroke","currentColor","stroke-width","2"],[1,"spinner"],["appBox","",1,"blocked-banner"],["title","Review pending changes requested by the user and decide whether to approve or reject them.",3,"personalInfo","vehicleInfo","request"],[3,"tabChange","tabs","activeTab","alignment"],["appTabIcon","personal"],["appTabIcon","vehicle"],["appBox","",2,"margin-bottom","2rem"],[3,"tabId","activeTab"],[3,"readonly","personalInfo","showPhotoUpload"],[1,"blocked-icon"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],[1,"blocked-content"],[1,"btn-reject",3,"click","disabled"],[1,"btn-approve",3,"click","disabled"],["d","M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z","stroke","currentColor","stroke-width","2"],["d","M5 17h14M5 17a2 2 0 1 1 0-4M5 17a2 2 0 1 0 0-4m14 4a2 2 0 1 0 0-4m0 4a2 2 0 1 1 0-4M3 11l2-7h14l2 7M5 13h14","stroke","currentColor","stroke-width","2"],[3,"readonly","vehicleInfo","vehicleTypes","availableServices"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),u("click",function(){return a.goBack()}),c(3," \u2190 Back to Users "),o(),i(4,"div",3)(5,"h1"),c(6,"User Details"),o(),i(7,"div",4)(8,"button",5),u("click",function(){return a.openChat()}),f(),i(9,"svg",6),p(10,"path",7),o(),c(11," View Chat "),o(),m(12,B,5,1,"button",8),m(13,N,5,1,"button",9),o()()(),m(14,A,4,0,"div",10),m(15,K,10,12,"div",11),o()),e&2&&(r(12),b(a.personalInfo()&&!a.personalInfo().blocked?12:-1),r(),b(a.personalInfo()&&a.personalInfo().blocked?13:-1),r(),b(a.isLoading()?14:-1),r(),b(!a.isLoading()&&a.personalInfo()?15:-1))},dependencies:[I,R,E,U,S,T,V],styles:[".user-detail-container[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto;background:#2d2d2d;min-height:100vh}.header[_ngcontent-%COMP%]{margin-bottom:2rem}.btn-back[_ngcontent-%COMP%]{background:#2d7a52;color:#fff;border:none;padding:.75rem 1.5rem;border-radius:8px;cursor:pointer;margin-bottom:1rem;font-size:.95rem;font-weight:500;transition:all .2s ease;display:inline-flex;align-items:center;gap:.5rem}.btn-back[_ngcontent-%COMP%]:hover{background:#3a8f64;transform:translateY(-1px);box-shadow:0 4px 8px #0000004d}.header-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}.header-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#fff;font-size:2rem;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.btn-chat[_ngcontent-%COMP%], .btn-block[_ngcontent-%COMP%], .btn-unblock[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s ease;display:inline-flex;align-items:center;gap:.5rem}.btn-chat[_ngcontent-%COMP%]{background:#2d7a52;color:#fff}.btn-chat[_ngcontent-%COMP%]:hover{background:#3a8f64}.btn-block[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-block[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn-unblock[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-unblock[_ngcontent-%COMP%]:hover:not(:disabled){background:#218838}.btn-block[_ngcontent-%COMP%]:disabled, .btn-unblock[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem}.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:1rem;color:#b0b0b0;font-size:1.1rem}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #1a1a1a;border-top:4px solid #f4d03f;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{background:#dc354533;color:#ff6b6b;padding:1rem 1.5rem;border-radius:8px;display:flex;align-items:center;gap:.75rem;border:1px solid rgba(220,53,69,.3);margin-bottom:1.5rem}.error-message[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:1.5rem}.user-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.blocked-banner[_ngcontent-%COMP%]{background:#dc35451a!important;border-color:#dc354580!important;display:flex;gap:1rem;align-items:flex-start}.blocked-icon[_ngcontent-%COMP%]{color:#ff6b6b;flex-shrink:0}.blocked-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#ff6b6b;margin:0 0 .5rem;font-size:1.25rem}.blocked-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:0;line-height:1.6}.blocked-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#ff6b6b}.pending-request-banner[_ngcontent-%COMP%]{background:#f4d03f1a!important;border-color:#f4d03f80!important}.pending-header[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start;margin-bottom:1.5rem}.pending-icon[_ngcontent-%COMP%]{color:#f4d03f;flex-shrink:0}.pending-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#f4d03f;margin:0 0 .5rem;font-size:1.25rem}.pending-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#b0b0b0;margin:0;line-height:1.6}.pending-changes[_ngcontent-%COMP%]{margin-bottom:1.5rem}.pending-changes[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#fff;margin:0 0 1rem;font-size:1.1rem}.changes-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.change-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:150px 1fr auto 1fr;gap:1rem;align-items:center;padding:.75rem;background:#1a5d3a33;border-radius:6px}.change-label[_ngcontent-%COMP%]{color:#b0b0b0;font-weight:500}.change-old[_ngcontent-%COMP%]{color:#ff6b6b;text-decoration:line-through}.change-arrow[_ngcontent-%COMP%]{color:#f4d03f;font-weight:700}.change-new[_ngcontent-%COMP%]{color:#28a745;font-weight:600}.pending-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding-top:1rem;border-top:1px solid rgba(26,93,58,.3)}.btn-reject[_ngcontent-%COMP%], .btn-approve[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s ease}.btn-reject[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-reject[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn-approve[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-approve[_ngcontent-%COMP%]:hover:not(:disabled){background:#218838}.btn-reject[_ngcontent-%COMP%]:disabled, .btn-approve[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;border-bottom:2px solid #1a5d3a}.tab-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:1rem 1.5rem;background:transparent;border:none;color:#b0b0b0;font-size:.95rem;font-weight:500;cursor:pointer;transition:all .2s ease;border-bottom:3px solid transparent;margin-bottom:-2px}.tab-button[_ngcontent-%COMP%]:hover{color:#fff;background:#1a5d3a1a}.tab-button.active[_ngcontent-%COMP%]{color:#f4d03f;border-bottom-color:#f4d03f}.tab-content-container[_ngcontent-%COMP%]{min-height:300px}.info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#b0b0b0;font-size:.875rem;font-weight:500;text-transform:capitalize}.info-value[_ngcontent-%COMP%]{color:#fff;font-size:1rem;padding:.75rem;background:#0d3d23;border:1px solid #1a5d3a;border-radius:8px}.badge[_ngcontent-%COMP%]{display:inline-block;padding:.35rem .75rem;border-radius:6px;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.badge-admin[_ngcontent-%COMP%]{background:#2d7a52;color:#fff}.badge-customer[_ngcontent-%COMP%]{background:#3a8f64;color:#fff}.badge-driver[_ngcontent-%COMP%]{background:#f4d03f;color:#1a1a1a}.profile-image-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.profile-image-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#b0b0b0;font-size:.875rem;font-weight:500}.profile-image[_ngcontent-%COMP%]{max-width:300px;border-radius:12px;border:2px solid #1a5d3a}.services-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.services-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#b0b0b0;font-size:.875rem;font-weight:500;text-transform:capitalize}.services-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem}.service-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:#1a5d3a4d;border:1px solid #1a5d3a;border-radius:6px;color:#28a745;font-size:.9rem;font-weight:500}@media(max-width:768px){.user-detail-container[_ngcontent-%COMP%]{padding:1rem}.header-title[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.header-actions[_ngcontent-%COMP%]{width:100%;flex-direction:column}.btn-chat[_ngcontent-%COMP%], .btn-block[_ngcontent-%COMP%], .btn-unblock[_ngcontent-%COMP%]{width:100%;justify-content:center}.info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.change-item[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.5rem}.change-arrow[_ngcontent-%COMP%]{display:none}.pending-actions[_ngcontent-%COMP%]{flex-direction:column}.btn-reject[_ngcontent-%COMP%], .btn-approve[_ngcontent-%COMP%]{width:100%}.tabs[_ngcontent-%COMP%]{overflow-x:auto}}"]})};export{j as UserDetailsPageComponent};
