import{a as E,b as I}from"./chunk-L4J4OC2G.js";import"./chunk-BYXBJQAS.js";import"./chunk-6HEX5QYM.js";import"./chunk-OXPWAMAC.js";import{b as y}from"./chunk-5IMUJISG.js";import{b as k}from"./chunk-GX4BJWGY.js";import"./chunk-WZWIJEA2.js";import{Fb as M,Ha as r,Hb as s,Ib as g,Jb as O,P as l,U as p,V as m,Va as b,eb as u,fa as C,fb as f,ib as v,jb as P,kb as w,lb as i,mb as a,sc as S,ub as x,wb as _,yb as c}from"./chunk-GHGVHUHC.js";import"./chunk-TSRGIXR5.js";var T=(n,t)=>t.id;function z(n,t){n&1&&(i(0,"div",4),s(1,"Loading chats..."),a())}function D(n,t){if(n&1){let e=x();i(0,"div",11),_("click",function(){let d=p(e).$index,h=c();return m(h.selectChat(d))}),i(1,"div",12)(2,"span",13),s(3),a(),i(4,"span",14),s(5),a()(),i(6,"div",15),s(7),a()()}if(n&2){let e=t.$implicit,o=c();M("selected",(o.selectedChat==null?null:o.selectedChat.id)===e.id),r(3),g(e.userEmail),r(2),g(e.userType),r(2),O(" ",o.getLastMessagePreview(e)," ")}}function V(n,t){n&1&&(i(0,"div",7),s(1,"No active chats"),a())}function L(n,t){if(n&1){let e=x();i(0,"app-chat-window",16),_("close",function(){p(e);let d=c();return m(d.closeSelectedChat())})("messageSend",function(d){p(e);let h=c();return m(h.onSend(d))}),a()}if(n&2){let e=c();w("chat",e.selectedChat)("title",e.getChatTitle(e.selectedChat))("isOpen",!0)("isMinimizable",!1)("userId",e.userId())}}function N(n,t){n&1&&(i(0,"div",10)(1,"div",17),s(2,"\u{1F4AC}"),a(),i(3,"p"),s(4,"Select a chat to start messaging"),a()())}var A=class n{chatService=l(I);authService=l(y);popupService=l(k);chats=this.chatService.chats;selectedChatIndex=C(-1);isLoading=C(!1);selectChat(t){this.selectedChatIndex.set(t)}closeSelectedChat(){this.selectedChatIndex.set(-1)}getChatTitle(t){return`${t.userEmail||"User"} (${t.userType||"Unknown"})`}getLastMessagePreview(t){if(t.messages.length===0)return"No messages yet";let e=t.messages[t.messages.length-1].content;return e.length>50?e.substring(0,50)+"...":e}userId(){return this.authService.user()?.id||-1}get selectedChat(){return this.selectedChatIndex()===-1?null:this.chats()[this.selectedChatIndex()]}onSend(t){this.chatService.sendMessage(this.selectedChat?.id,t).subscribe({next:e=>{},error:e=>{this.popupService.error("Error sending message","Failed to send your message. Please try again later."),console.error("[UserChatComponent] Error sending message:",e)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["app-admin-chats-page"]],decls:15,vars:4,consts:[[1,"admin-chats-page"],[1,"chats-sidebar"],[1,"sidebar-header"],[1,"chat-count"],[1,"loading"],[1,"chats-list"],[1,"chat-item",3,"selected"],[1,"no-chats"],[1,"chat-display"],[3,"chat","title","isOpen","isMinimizable","userId"],[1,"no-selection"],[1,"chat-item",3,"click"],[1,"chat-item-header"],[1,"user-email"],[1,"user-type"],[1,"chat-item-preview"],[3,"close","messageSend","chat","title","isOpen","isMinimizable","userId"],[1,"icon"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),s(4,"Active Support Chats"),a(),i(5,"span",3),s(6),a()(),u(7,z,2,0,"div",4),i(8,"div",5),v(9,D,8,5,"div",6,T,!1,V,2,0,"div",7),a()(),i(12,"div",8),u(13,L,1,5,"app-chat-window",9)(14,N,5,0,"div",10),a()()),e&2&&(r(6),g(o.chats().length),r(),f(o.isLoading()?7:-1),r(2),P(o.chats()),r(4),f(o.selectedChat?13:14))},dependencies:[S,E],styles:[".admin-chats-page[_ngcontent-%COMP%]{display:flex;height:100vh;background:#1a1a1a}.chats-sidebar[_ngcontent-%COMP%]{width:350px;background:#2b2b2b;border-right:1px solid #3a3a3a;display:flex;flex-direction:column}.sidebar-header[_ngcontent-%COMP%]{padding:20px;background:#1a5c3a;color:#fff;display:flex;justify-content:space-between;align-items:center}.sidebar-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600}.chat-count[_ngcontent-%COMP%]{background:#5a4a2a;color:#fff;padding:4px 12px;border-radius:12px;font-size:14px;font-weight:600}.loading[_ngcontent-%COMP%]{padding:20px;text-align:center;color:#888}.chats-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.chats-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chats-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1f1f1f}.chats-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:3px}.chat-item[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #3a3a3a;cursor:pointer;transition:background .2s}.chat-item[_ngcontent-%COMP%]:hover{background:#333}.chat-item.selected[_ngcontent-%COMP%]{background:#1a5c3a}.chat-item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.user-email[_ngcontent-%COMP%]{color:#fff;font-weight:600;font-size:14px}.user-type[_ngcontent-%COMP%]{background:#5a4a2a;color:#fff;padding:2px 8px;border-radius:10px;font-size:11px;text-transform:uppercase}.chat-item-preview[_ngcontent-%COMP%]{color:#aaa;font-size:13px;margin-bottom:8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.chat-item-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.time[_ngcontent-%COMP%]{color:#888;font-size:12px}.unread-badge[_ngcontent-%COMP%]{background:#d32f2f;color:#fff;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600}.no-chats[_ngcontent-%COMP%]{padding:40px 20px;text-align:center;color:#888}.chat-display[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;position:relative}.chat-display[_ngcontent-%COMP%]   app-chat-window[_ngcontent-%COMP%]{position:static;width:100%;height:100%;max-width:800px}.chat-display[_ngcontent-%COMP%]   app-chat-window[_ngcontent-%COMP%]  .chat-container{position:static;width:100%;height:100%;max-height:none;border-radius:0}.no-selection[_ngcontent-%COMP%]{text-align:center;color:#888}.no-selection[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:16px}.no-selection[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}"]})};export{A as AdminChatsPageComponent};
