import{a as q}from"./chunk-N5ONJPTC.js";import"./chunk-BYXBJQAS.js";import"./chunk-PBSO56S7.js";import{b as L,d as A,h as U,j as W,o as j,p as Y,u as G}from"./chunk-OXPWAMAC.js";import{f as z}from"./chunk-DMUBA5XY.js";import{b as B}from"./chunk-5IMUJISG.js";import{b as Z}from"./chunk-GX4BJWGY.js";import{a as I}from"./chunk-WZWIJEA2.js";import{Ac as V,G as O,Ha as d,Hb as c,Ib as T,Jb as F,K as P,Lb as k,Mb as b,Nb as v,Ob as x,P as f,U as p,V as u,Va as R,Xb as y,eb as _,fa as l,fb as C,hb as E,ib as w,jb as M,kb as m,lb as s,mb as r,sc as H,ub as D,wb as h,xc as N,yb as g}from"./chunk-GHGVHUHC.js";import"./chunk-TSRGIXR5.js";var J={CUSTOMER:{showDriverInfo:!0,showPassengerInfo:!1,showPanicButton:!1,showInconsistencyReports:!0,showRatings:!0,showReorderOption:!0,canViewDetails:!0,showUserFilters:!1,showRateButton:!0},DRIVER:{showDriverInfo:!1,showPassengerInfo:!0,showPanicButton:!0,showInconsistencyReports:!1,showRatings:!1,showReorderOption:!1,canViewDetails:!0,showUserFilters:!1,showRateButton:!1},ADMIN:{showDriverInfo:!0,showPassengerInfo:!0,showPanicButton:!0,showInconsistencyReports:!0,showRatings:!0,showReorderOption:!1,canViewDetails:!0,showUserFilters:!0,showRateButton:!1}},K=[5,10,20,50],ee=[{field:"scheduledTime",label:"Scheduled Time"},{field:"startTime",label:"Start Time"},{field:"endTime",label:"End Time"},{field:"totalCost",label:"Total Cost"},{field:"status",label:"Status"}],Q={CUSTOMER:[{field:"scheduledTime",label:"Scheduled Time"},{field:"startTime",label:"Start Time"},{field:"totalCost",label:"Total Cost"}],DRIVER:[{field:"scheduledTime",label:"Scheduled Time"},{field:"startTime",label:"Start Time"},{field:"endTime",label:"End Time"}],ADMIN:ee};var S=class o{http=f(V);popupsService=f(Z);rides=l([]);page=l(0);size=l(5);totalElements=l(0);loading=l(!1);loadingDetails=l(!1);sortField=l("scheduledTime");sortDirection=l("DESC");startDate=l(null);endDate=l(null);driverId=l(null);customerId=l(null);selectedRide=l(null);getHistory(){this.loading.set(!0);let t=new N().set("page",this.page()).set("size",this.size()).set("sortBy",this.sortField()).set("sortDirection",this.sortDirection());this.startDate()&&(t=t.set("startDate",this.startDate())),this.endDate()&&(t=t.set("endDate",this.endDate())),this.driverId()&&(t=t.set("driverId",this.driverId())),this.customerId()&&(t=t.set("customerId",this.customerId())),this.http.get(`/api/${I.apiVersion}/rides/history`,{params:t}).subscribe({next:e=>{this.rides.set(e.content),this.totalElements.set(e.totalElements),this.loading.set(!1)},error:e=>{this.popupsService.error("Error","Failed to load ride history. Please try again later. "+e.message),this.loading.set(!1)}})}getRideDetails(){return this.loadingDetails.set(!0),this.http.get(`/api/${I.apiVersion}/rides/${this.selectedRide()?.id}`).pipe(O({next:()=>this.loadingDetails.set(!1),error:()=>this.loadingDetails.set(!1)}))}setPage(t){this.page.set(t),this.getHistory()}setPageSize(t){this.size.set(t),this.page.set(0),this.getHistory()}setSortField(t){this.sortField.set(t),this.page.set(0),this.getHistory()}toggleSortDirection(){this.sortDirection.set(this.sortDirection()==="ASC"?"DESC":"ASC"),this.page.set(0),this.getHistory()}setSorting(t,e){this.sortField.set(t),this.sortDirection.set(e),this.page.set(0),this.getHistory()}setDateRange(t,e){this.startDate.set(t),this.endDate.set(e),this.page.set(0),this.getHistory()}setUserFilters(t,e){this.driverId.set(t),this.customerId.set(e),this.page.set(0),this.getHistory()}clearFilters(){this.startDate.set(null),this.endDate.set(null),this.driverId.set(null),this.customerId.set(null),this.page.set(0),this.getHistory()}reset(){this.page.set(0),this.size.set(5),this.sortField.set("scheduledTime"),this.sortDirection.set("DESC"),this.startDate.set(null),this.endDate.set(null),this.driverId.set(null),this.customerId.set(null)}toggleFavorite(t){}static \u0275fac=function(e){return new(e||o)};static \u0275prov=P({token:o,factory:o.\u0275fac,providedIn:"root"})};var ie=(o,t)=>t.field;function oe(o,t){if(o&1&&(s(0,"option",4),c(1),r()),o&2){let e=t.$implicit;m("value",e.field),d(),T(e.label)}}function ne(o,t){o&1&&c(0," \u2191 Ascending ")}function re(o,t){o&1&&c(0," \u2193 Descending ")}function se(o,t){o&1&&c(0," \u25B2 ")}function ae(o,t){o&1&&c(0," \u25BC ")}function le(o,t){if(o&1){let e=D();s(0,"div",10)(1,"label",18),c(2,"Driver ID:"),r(),s(3,"input",19),x("ngModelChange",function(i){p(e);let a=g(2);return v(a.filterDriverId,i)||(a.filterDriverId=i),u(i)}),r()(),s(4,"div",10)(5,"label",20),c(6,"Customer ID:"),r(),s(7,"input",21),x("ngModelChange",function(i){p(e);let a=g(2);return v(a.filterCustomerId,i)||(a.filterCustomerId=i),u(i)}),r()()}if(o&2){let e=g(2);d(3),b("ngModel",e.filterDriverId),d(4),b("ngModel",e.filterCustomerId)}}function de(o,t){if(o&1){let e=D();s(0,"div",7)(1,"div",10)(2,"label",11),c(3,"Start Date:"),r(),s(4,"input",12),x("ngModelChange",function(i){p(e);let a=g();return v(a.filterStartDate,i)||(a.filterStartDate=i),u(i)}),r()(),s(5,"div",10)(6,"label",13),c(7,"End Date:"),r(),s(8,"input",14),x("ngModelChange",function(i){p(e);let a=g();return v(a.filterEndDate,i)||(a.filterEndDate=i),u(i)}),r()(),_(9,le,8,2),s(10,"div",15)(11,"button",16),h("click",function(){p(e);let i=g();return u(i.applyFilters())}),c(12," Apply Filters "),r(),s(13,"button",17),h("click",function(){p(e);let i=g();return u(i.clearFilters())}),c(14," Clear Filters "),r()()()}if(o&2){let e=g();d(4),b("ngModel",e.filterStartDate),d(4),b("ngModel",e.filterEndDate),d(),C(e.config().showUserFilters?9:-1)}}function ce(o,t){if(o&1&&(s(0,"option",4),c(1),r()),o&2){let e=t.$implicit;m("value",e),d(),F("",e," per page")}}function ge(o,t){if(o&1){let e=D();s(0,"div",9)(1,"button",22),h("click",function(){p(e);let i=g();return u(i.previousPage())}),c(2," Previous "),r(),s(3,"span",23),c(4),r(),s(5,"button",22),h("click",function(){p(e);let i=g();return u(i.nextPage())}),c(6," Next "),r(),s(7,"select",24),h("change",function(i){p(e);let a=g();return u(a.onPageSizeChange(+i.target.value))}),w(8,ce,2,2,"option",4,E),r()()}if(o&2){let e=g();d(),m("disabled",e.page()===0),d(3),k(" Page ",e.page()+1," of ",e.Math.ceil(e.totalElements()/e.size())," (",e.totalElements()," total rides) "),d(),m("disabled",(e.page()+1)*e.size()>=e.totalElements()),d(2),m("value",e.size()),d(),M(e.pageSizeOptions)}}var X=class o{router=f(z);authService=f(B);userRole=y(()=>this.authService.user().role);historyService=f(S);rides=this.historyService.rides;loading=this.historyService.loading;totalElements=this.historyService.totalElements;page=this.historyService.page;size=this.historyService.size;sortField=this.historyService.sortField;sortDirection=this.historyService.sortDirection;filterStartDate=l("");filterEndDate=l("");filterDriverId=l("");filterCustomerId=l("");config=y(()=>J[this.userRole()]);ridesListConfig=y(()=>({canViewDetails:this.config().canViewDetails,showDriverInfo:this.config().showDriverInfo,showPassengerInfo:this.config().showPassengerInfo,showPanicButton:this.config().showPanicButton,showReorderOption:this.config().showReorderOption}));pageSizeOptions=K;sortOptions=y(()=>Q[this.userRole()]);showFilters=l(!1);Math=Math;ngOnInit(){this.loadRides()}loadRides(){this.historyService.getHistory()}onRideClick(t){this.historyService.selectedRide.set(t),this.router.navigate(["rides",t.id]).then()}onReorderNow(t){console.log("Reorder ride:",t)}nextPage(){(this.page()+1)*this.size()<this.totalElements()&&this.historyService.setPage(this.page()+1)}previousPage(){this.page()>0&&this.historyService.setPage(this.page()-1)}onPageSizeChange(t){this.historyService.setPageSize(t)}onSortFieldChange(t){this.historyService.setSortField(t)}toggleSortDirection(){this.historyService.toggleSortDirection()}toggleFilters(){this.showFilters.set(!this.showFilters())}applyFilters(){let t=this.filterStartDate(),e=this.filterEndDate(),n=t?t+"T00:00:00":null,i=e?e+"T23:59:59":null;if(this.historyService.setDateRange(n,i),this.config().showUserFilters){let a=this.filterDriverId()?+this.filterDriverId():null,$=this.filterCustomerId()?+this.filterCustomerId():null;this.historyService.setUserFilters(a,$)}}clearFilters(){this.filterStartDate.set(""),this.filterEndDate.set(""),this.filterDriverId.set(""),this.filterCustomerId.set(""),this.historyService.clearFilters()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=R({type:o,selectors:[["app-history"]],decls:18,vars:8,consts:[[1,"ride-history-container"],[1,"history-header"],[1,"history-controls"],[1,"sort-field-select",3,"change","value"],[3,"value"],[1,"btn-sort",3,"click"],[1,"btn-filter",3,"click"],[1,"filters-panel"],[3,"rideClick","reorderClick","rides","config","loading"],[1,"pagination"],[1,"filter-group"],["for","startDate"],["type","date","id","startDate",1,"date-input",3,"ngModelChange","ngModel"],["for","endDate"],["type","date","id","endDate",1,"date-input",3,"ngModelChange","ngModel"],[1,"filter-actions"],[1,"btn-apply",3,"click"],[1,"btn-clear",3,"click"],["for","driverId"],["type","number","id","driverId","placeholder","Enter driver ID",1,"date-input",3,"ngModelChange","ngModel"],["for","customerId"],["type","number","id","customerId","placeholder","Enter customer ID",1,"date-input",3,"ngModelChange","ngModel"],[1,"btn-pagination",3,"click","disabled"],[1,"pagination-info"],[1,"page-size-select",3,"change","value"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"div",1)(2,"h2"),c(3,"Ride History"),r(),s(4,"div",2)(5,"select",3),h("change",function(a){return n.onSortFieldChange(a.target.value)}),w(6,oe,2,2,"option",4,ie),r(),s(8,"button",5),h("click",function(){return n.toggleSortDirection()}),_(9,ne,1,0)(10,re,1,0),r(),s(11,"button",6),h("click",function(){return n.toggleFilters()}),c(12," \u{1F50D} Filters "),_(13,se,1,0)(14,ae,1,0),r()()(),_(15,de,15,3,"div",7),s(16,"app-rides-list",8),h("rideClick",function(a){return n.onRideClick(a)})("reorderClick",function(a){return n.onReorderNow(a)}),r(),_(17,ge,10,6,"div",9),r()),e&2&&(d(5),m("value",n.sortField()),d(),M(n.sortOptions()),d(3),C(n.sortDirection()==="ASC"?9:10),d(4),C(n.showFilters()?13:14),d(2),C(n.showFilters()?15:-1),d(),m("rides",n.rides())("config",n.ridesListConfig())("loading",n.loading()),d(),C(n.totalElements()>0&&!n.loading()?17:-1))},dependencies:[H,G,j,Y,L,W,A,U,q],styles:["[_nghost-%COMP%]{--primary-green: #2d5a3d;--dark-bg: #2a2a2a;--card-bg: #3a3a3a;--accent-green: #4a9d5f;--light-green: #5cb85c;--text-light: #e0e0e0;--text-muted: #999;--border-color: #4a4a4a}.ride-history-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto;background-color:var(--dark-bg);min-height:100vh;color:var(--text-light)}h2[_ngcontent-%COMP%]{margin-bottom:24px;color:var(--text-light)}.history-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:15px;padding:20px;background-color:var(--primary-green);border-radius:8px;box-shadow:0 2px 8px #0000004d}.history-controls[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap}.sort-field-select[_ngcontent-%COMP%], .page-size-select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid var(--border-color);border-radius:6px;background-color:var(--card-bg);color:var(--text-light);cursor:pointer;font-size:14px;transition:all .2s}.sort-field-select[_ngcontent-%COMP%]:hover, .page-size-select[_ngcontent-%COMP%]:hover{border-color:var(--accent-green)}.sort-field-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%], .page-size-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background-color:var(--card-bg);color:var(--text-light)}.btn-sort[_ngcontent-%COMP%], .btn-filter[_ngcontent-%COMP%]{padding:8px 16px;background-color:var(--card-bg);color:var(--text-light);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;transition:all .2s;font-size:14px;font-weight:600}.btn-sort[_ngcontent-%COMP%]:hover, .btn-filter[_ngcontent-%COMP%]:hover{background-color:#4a4a4a;border-color:var(--accent-green)}.filters-panel[_ngcontent-%COMP%]{background-color:var(--card-bg);border:1px solid var(--border-color);border-radius:8px;padding:20px;margin-bottom:20px;display:flex;gap:15px;flex-wrap:wrap;align-items:flex-end}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;min-width:200px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px}.date-input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid var(--border-color);border-radius:6px;font-size:14px;background-color:var(--dark-bg);color:var(--text-light);transition:all .2s}.date-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent-green)}.filter-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.btn-apply[_ngcontent-%COMP%], .btn-clear[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s}.btn-apply[_ngcontent-%COMP%]{background-color:var(--light-green);color:#fff}.btn-apply[_ngcontent-%COMP%]:hover{background-color:var(--accent-green);transform:translateY(-2px)}.btn-clear[_ngcontent-%COMP%]{background-color:var(--card-bg);color:var(--text-light);border:1px solid var(--border-color)}.btn-clear[_ngcontent-%COMP%]:hover{background-color:#4a4a4a;border-color:#8b3a3a}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:16px;margin-top:24px;padding:16px;background-color:var(--card-bg);border-radius:8px;border:1px solid var(--border-color)}.btn-pagination[_ngcontent-%COMP%]{padding:8px 16px;background-color:var(--light-green);color:#fff;border:none;border-radius:6px;cursor:pointer;transition:all .2s;font-weight:600}.btn-pagination[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--accent-green);transform:translateY(-2px)}.btn-pagination[_ngcontent-%COMP%]:disabled{background-color:#5a5a5a;cursor:not-allowed;opacity:.5}.pagination-info[_ngcontent-%COMP%]{font-size:14px;color:var(--text-light)}.page-size-select[_ngcontent-%COMP%]{padding:6px 12px;border:1px solid var(--border-color);border-radius:4px;cursor:pointer}@media(max-width:768px){.history-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.history-controls[_ngcontent-%COMP%], .filters-panel[_ngcontent-%COMP%]{flex-direction:column}.filter-group[_ngcontent-%COMP%]{min-width:100%}}"]})};export{X as HistoryComponent};
